#!/usr/bin/env bash
set -o errexit
set -o nounset
set -o pipefail

# Set magic variables for current file & dir
__dir="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
__file="${__dir}/$(basename "${BASH_SOURCE[0]}")"
__base="$(basename ${__file} .sh)"

cd "$__dir/.."
source .env

if [[ $# -eq 1 ]]; then
    NODE="all"
    COMMAND="$1"
    ARGS="$@"
elif [[ $# -eq 2 ]]; then
    NODE="$1" && shift
    COMMAND="$1"
    ARGS="$@"
fi

L1_SET="bitcoin elecrs"
L2_SET="lnp-node"
L3_SET="rgb-node"

function setup_command() {
    # bitcoin-cli
    bcli="docker-compose exec bitcoin bitcoin-cli -chain=regtest -rpcconnect=localhost -rpcport=${BITCOIN_RPC_PORT} -rpcuser=${BITCOIN_RPC_USER} -rpcpassword=${BITCOIN_RPC_PASSWORD}"
    alias bitcoin-cli="${bcli}"

    echo $bcli
}

case "$COMMAND" in
    init) setup_command ;;
esac