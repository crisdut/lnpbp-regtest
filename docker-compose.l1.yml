version: "3"

networks:
  nodes_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/24
          gateway: 172.20.0.1    

volumes:
  node1_data:
  node2_data:
  cln1_data:
  lnp1_data:
  lnp2_data:  
  rgb1_data:
  rgb2_data:
  store1_data:
  store2_data:      

services:
  node1:
    build:
      context: ./bitcoin/
    container_name: node1
    restart: unless-stopped
    command:
      [
        "-regtest=1",
        "-upnp=0",
        "-server=1",
        "-txindex=1",
        "-onlynet=ipv4",
        "-dnsseed=0",
        "-dbcache=10",
        "-port=${BITCOIN_PORT}",
        "-rpcport=${BITCOIN_RPC_PORT}",
        "-rpcuser=${BITCOIN_RPC_USER}",
        "-rpcpassword=${BITCOIN_RPC_PASSWORD}",
        "-rpcallowip=0.0.0.0/0",
        "-rpcbind=127.0.0.1",
        "-rpcbind=${BITCOIN_HOST_1}",
        "-zmqpubrawtx=tcp://0.0.0.0:${BITCOIN_ZMQ_TX_PORT}",
        "-zmqpubhashtx=tcp://0.0.0.0:${BITCOIN_ZMQ_TX_PORT}",
        "-zmqpubrawblock=tcp://0.0.0.0:${BITCOIN_ZMQ_BLOCK_PORT}",
        "-zmqpubhashblock=tcp://0.0.0.0:${BITCOIN_ZMQ_BLOCK_PORT}",
      ]
    volumes:
      - node1_data:/home/bitcoin/.bitcoin
    networks:
      nodes_network:
        aliases:
          - ${BITCOIN_HOST_1}

  node2:
    build:
      context: ./bitcoin/
    container_name: node2
    restart: unless-stopped
    command:
      [
        "-regtest=1",
        "-upnp=0",
        "-server=1",
        "-txindex=1",
        "-onlynet=ipv4",
        "-dnsseed=0",
        "-dbcache=10",
        "-port=${BITCOIN_PORT}",
        "-rpcport=${BITCOIN_RPC_PORT}",
        "-rpcuser=${BITCOIN_RPC_USER}",
        "-rpcpassword=${BITCOIN_RPC_PASSWORD}",
        "-rpcallowip=0.0.0.0/0",
        "-rpcbind=127.0.0.1",
        "-rpcbind=${BITCOIN_HOST_1}",
        "-zmqpubrawtx=tcp://0.0.0.0:${BITCOIN_ZMQ_TX_PORT}",
        "-zmqpubhashtx=tcp://0.0.0.0:${BITCOIN_ZMQ_TX_PORT}",
        "-zmqpubrawblock=tcp://0.0.0.0:${BITCOIN_ZMQ_BLOCK_PORT}",
        "-zmqpubhashblock=tcp://0.0.0.0:${BITCOIN_ZMQ_BLOCK_PORT}",
      ]
    volumes:
      - node1_data:/home/bitcoin/.bitcoin
    networks:
      nodes_network:
        aliases:
          - ${BITCOIN_HOST_2}